import{F as d,j as s,I as _,B as m,r as l,C as w,f as T,g as z,T as k,h as A}from"./vendor-aZqaFPTA.js";import{A as f}from"./index-IYGUSpYK.js";async function x(t,e){let n=null;return sessionStorage.authToken&&(n=JSON.parse(sessionStorage.authToken)),e.headers||(e.headers={}),n&&(e.headers.Authorization=`Bearer ${n.access_token}`),fetch(t,e)}async function C(t,e){const n=t.map((r,c)=>c!==t.length-1?"order="+r+"&":"order="+r);return await x(f+`statistics?${n}&offset=${((e.pagination.current??0)-1)*(e.pagination.pageSize??10)}&limit=${e.pagination.pageSize}`,{})}const v=({hanldeSumbit:t})=>{const[e]=d.useForm(),n=({link:i})=>{t(i),e.resetFields()};return s.jsxs(d,{autoComplete:"off",form:e,onFinish:n,style:{marginTop:"20px"},children:[s.jsx(d.Item,{name:"link",label:"Ссылка",rules:[{required:!0,validator(i,r){return r&&r.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._=+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)?Promise.resolve():Promise.reject(new Error("Введите корректный URL!"))}}],children:s.jsx(_,{placeholder:"Ссылка"})}),s.jsx(d.Item,{children:s.jsx(m,{type:"primary",htmlType:"submit",children:"Добавить ссылку"})})]})},{Title:I}=k,F=[{value:"asc_short",label:"По алфавиту короткой ссылки"},{value:"asc_target",label:"По алфавиту исходной ссылки"},{value:"asc_counter",label:"По увелечению просмотров"},{value:"desc_short",label:"С конца алфавита по короткой ссылке"},{value:"desc_target",label:"С конца алфавита по исходной ссылке"},{value:"desc_counter",label:"По убыванию просмотров"}],g="https://front-test.hex.team/s/",B=[{title:"Короткие ссылки",dataIndex:"short",render:t=>s.jsxs(A,{children:[s.jsx("a",{target:"_blank",href:g+t,children:t}),s.jsx(m,{type:"default",href:"#",onClick:()=>navigator.clipboard.writeText(g+t),children:"copy"})]})},{title:"Исходные Ссылки",dataIndex:"target"},{title:"Посещений",dataIndex:"counter"}],O=()=>{const[t,e]=l.useState([]),[n,i]=l.useState(["desc_counter"]),[r,c]=l.useState(!1),[o,p]=l.useState({pagination:{current:1,pageSize:7,total:0}});l.useEffect(()=>{c(!0),C(n,o).then(a=>(p({...o,pagination:{...o.pagination,total:+(a.headers.get("x-total-count")||0)}}),a.json())).then(a=>{e(a),c(!1)})},[JSON.stringify(o),n]);const S=a=>{p({pagination:a}),a.pageSize!==o.pagination.pageSize&&e([])},j=async a=>{const u=await x(f+`squeeze?link=${a}`,{method:"POST"});if(u.ok){const h=await u.json();e(y=>[h,...y])}else{const h=await u.json();console.error(h)}},b=a=>{i(a)};return s.jsxs(w,{style:{width:800},children:[s.jsx(I,{style:{textAlign:"center"},children:"Таблица"}),s.jsx(T,{bordered:!0,rowKey:a=>a.id,columns:B,dataSource:t,loading:r,onChange:S,pagination:o.pagination,style:{marginBottom:"10px"}}),s.jsx(z,{mode:"multiple",defaultValue:n,style:{width:"100% "},onChange:b,options:F,disabled:r||t.length<2}),s.jsx(v,{hanldeSumbit:j})]})};export{O as Content,O as default};
