import{j as o,r as l}from"./react-RCQyz0-a.js";import{A as g}from"./index-I4WiICTQ.js";import{F as m,I as _,B as f,C as w,a as T,b as z,T as k,c as A}from"./antd-TeelbU8d.js";import"./classnames-bfnzNRGW.js";import"./react-dom-bICc-1QG.js";import"./scheduler-iwWdm5Ml.js";import"./@ant-design-BA9tpmVs.js";import"./rc-util-P8w88VWb.js";import"./react-is-q81m-9gd.js";import"./@babel-NyfAOc0i.js";import"./@emotion-folQEnri.js";import"./stylis-3miXmfPm.js";import"./resize-observer-polyfill-B32NGzNS.js";import"./@ctrl-_Y40OLZn.js";import"./react-router-dom-DC3mkGoW.js";import"./react-router-KONan6a8.js";import"./@remix-run-mwXkICKc.js";import"./rc-resize-observer-cjiFeZj2.js";import"./rc-motion-oPIyD74H.js";import"./rc-overflow-7c0vxWcQ.js";import"./rc-tabs-mn-x9B8p.js";import"./rc-dropdown-kAPu0UCo.js";import"./@rc-component-KC8IvooG.js";import"./rc-menu-KGG8ICqT.js";import"./rc-select-Dz__d0G3.js";import"./rc-virtual-list-_jxhUvxu.js";import"./rc-field-form-DxMmoZc0.js";import"./async-validator-BHjhHa7C.js";import"./scroll-into-view-if-needed-IfixhRVP.js";import"./compute-scroll-into-view--ODhS-4c.js";import"./rc-dialog-cWtjIEjL.js";import"./rc-table-fdn6viXV.js";import"./rc-tree-YOlhvjTS.js";import"./rc-checkbox-u3GHrUK_.js";import"./rc-pagination-9ZOphZrp.js";import"./throttle-debounce-5p4B7Tol.js";import"./copy-to-clipboard-fK7SzqP0.js";import"./toggle-selection-fekekO1r.js";import"./rc-picker-tWQw2FDN.js";import"./rc-tooltip-dMl4sTbv.js";import"./rc-textarea-OVKOvZl-.js";import"./rc-input--39Gh9OY.js";async function x(e,t){let a=null;return sessionStorage.authToken&&(a=JSON.parse(sessionStorage.authToken)),t.headers||(t.headers={}),a&&(t.headers.Authorization=`Bearer ${a.access_token}`),fetch(e,t)}async function C(e,t){const a=e.map((i,p)=>p!==e.length-1?"order="+i+"&":"order="+i);return await x(g+`statistics?${a}&offset=${((t.pagination.current??0)-1)*(t.pagination.pageSize??10)}&limit=${t.pagination.pageSize}`,{})}const v=({hanldeSumbit:e})=>{const[t]=m.useForm(),a=({link:n})=>{e(n),t.resetFields()};return o.jsxs(m,{autoComplete:"off",form:t,onFinish:a,style:{marginTop:"20px"},children:[o.jsx(m.Item,{name:"link",label:"Ссылка",rules:[{required:!0,validator(n,i){return i&&i.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._=+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)?Promise.resolve():Promise.reject(new Error("Введите корректный URL!"))}}],children:o.jsx(_,{placeholder:"Ссылка"})}),o.jsx(m.Item,{children:o.jsx(f,{type:"primary",htmlType:"submit",children:"Добавить ссылку"})})]})},{Title:I}=k,F=[{value:"asc_short",label:"По алфавиту короткой ссылки"},{value:"asc_target",label:"По алфавиту исходной ссылки"},{value:"asc_counter",label:"По увелечению просмотров"},{value:"desc_short",label:"С конца алфавита по короткой ссылке"},{value:"desc_target",label:"С конца алфавита по исходной ссылке"},{value:"desc_counter",label:"По убыванию просмотров"}],h="https://front-test.hex.team/s/",B=[{title:"Короткие ссылки",dataIndex:"short",render:e=>o.jsxs(A,{children:[o.jsx("a",{target:"_blank",href:h+e,children:e}),o.jsx(f,{type:"default",href:"#",onClick:()=>navigator.clipboard.writeText(h+e),children:"copy"})]})},{title:"Исходные Ссылки",dataIndex:"target"},{title:"Посещений",dataIndex:"counter"}],yt=()=>{const[e,t]=l.useState([]),[a,n]=l.useState(["desc_counter"]),[i,p]=l.useState(!1),[s,u]=l.useState({pagination:{current:1,pageSize:7,total:0}});l.useEffect(()=>{p(!0),C(a,s).then(r=>(u({...s,pagination:{...s.pagination,total:+(r.headers.get("x-total-count")||0)}}),r.json())).then(r=>{t(r),p(!1)})},[JSON.stringify(s),a]);const S=r=>{u({pagination:r}),r.pageSize!==s.pagination.pageSize&&t([])},j=async r=>{const c=await x(g+`squeeze?link=${r}`,{method:"POST"});if(c.ok){const d=await c.json();t(y=>[d,...y])}else{const d=await c.json();console.error(d)}},b=r=>{n(r)};return o.jsxs(w,{style:{width:800},children:[o.jsx(I,{style:{textAlign:"center"},children:"Таблица"}),o.jsx(T,{bordered:!0,rowKey:r=>r.id,columns:B,dataSource:e,loading:i,onChange:S,pagination:s.pagination,style:{marginBottom:"10px"}}),o.jsx(z,{mode:"multiple",defaultValue:a,style:{width:"100% "},onChange:b,options:F,disabled:i||e.length<2}),o.jsx(v,{hanldeSumbit:j})]})};export{yt as Content,yt as default};
