import{j as r,r as d}from"./react-RCQyz0-a.js";import{A as g,u as w}from"./index-lEYdlTW0.js";import{F as u,I as _,B as x,C as T,a as k,b as C,T as z,c as A}from"./antd-TeelbU8d.js";import"./classnames-bfnzNRGW.js";import"./react-dom-bICc-1QG.js";import"./scheduler-iwWdm5Ml.js";import"./@ant-design-BA9tpmVs.js";import"./rc-util-P8w88VWb.js";import"./react-is-q81m-9gd.js";import"./@babel-NyfAOc0i.js";import"./@emotion-folQEnri.js";import"./stylis-3miXmfPm.js";import"./resize-observer-polyfill-B32NGzNS.js";import"./@ctrl-_Y40OLZn.js";import"./react-router-KONan6a8.js";import"./@remix-run-mwXkICKc.js";import"./react-router-dom-DC3mkGoW.js";import"./rc-resize-observer-cjiFeZj2.js";import"./rc-motion-oPIyD74H.js";import"./rc-overflow-7c0vxWcQ.js";import"./rc-tabs-mn-x9B8p.js";import"./rc-dropdown-kAPu0UCo.js";import"./@rc-component-KC8IvooG.js";import"./rc-menu-KGG8ICqT.js";import"./rc-select-Dz__d0G3.js";import"./rc-virtual-list-_jxhUvxu.js";import"./rc-field-form-DxMmoZc0.js";import"./async-validator-BHjhHa7C.js";import"./scroll-into-view-if-needed-IfixhRVP.js";import"./compute-scroll-into-view--ODhS-4c.js";import"./rc-dialog-cWtjIEjL.js";import"./rc-table-fdn6viXV.js";import"./rc-tree-YOlhvjTS.js";import"./rc-checkbox-u3GHrUK_.js";import"./rc-pagination-9ZOphZrp.js";import"./throttle-debounce-5p4B7Tol.js";import"./copy-to-clipboard-fK7SzqP0.js";import"./toggle-selection-fekekO1r.js";import"./rc-picker-tWQw2FDN.js";import"./rc-tooltip-dMl4sTbv.js";import"./rc-textarea-OVKOvZl-.js";import"./rc-input--39Gh9OY.js";async function b(e,t){let a=null;return sessionStorage.authToken&&(a=JSON.parse(sessionStorage.authToken)),t.headers||(t.headers={}),a&&(t.headers.Authorization=`Bearer ${a.access_token}`),fetch(e,t)}async function I(e,t){const a=e.map((s,c)=>c!==e.length-1?"order="+s+"&":"order="+s);return await b(g+`statistics?${a}&offset=${((t.current??0)-1)*(t.pageSize??10)}&limit=${t.pageSize}`,{})}const v=({hanldeSumbit:e})=>{const[t]=u.useForm(),a=({link:n})=>{e(n),t.resetFields()};return r.jsxs(u,{autoComplete:"off",form:t,onFinish:a,style:{marginTop:"20px"},children:[r.jsx(u.Item,{name:"link",label:"Ссылка",rules:[{required:!0,validator(n,s){return s&&s.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._=+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)?Promise.resolve():Promise.reject(new Error("Введите корректный URL!"))}}],children:r.jsx(_,{placeholder:"Ссылка"})}),r.jsx(u.Item,{children:r.jsx(x,{type:"primary",htmlType:"submit",children:"Добавить ссылку"})})]})},{Title:F}=z,E=[{value:"asc_short",label:"По алфавиту короткой ссылки"},{value:"asc_target",label:"По алфавиту исходной ссылки"},{value:"asc_counter",label:"По увелечению просмотров"},{value:"desc_short",label:"С конца алфавита по короткой ссылке"},{value:"desc_target",label:"С конца алфавита по исходной ссылке"},{value:"desc_counter",label:"По убыванию просмотров"}],f="https://front-test.hex.team/s/",P=[{title:"Короткие ссылки",dataIndex:"short",render:e=>r.jsxs(A,{children:[r.jsx("a",{target:"_blank",href:f+e,children:e}),r.jsx(x,{type:"default",href:"#",onClick:()=>navigator.clipboard.writeText(f+e),children:"copy"})]})},{title:"Исходные Ссылки",dataIndex:"target"},{title:"Посещений",dataIndex:"counter"}],wt=()=>{const[e,t]=d.useState([]),[a,n]=d.useState([]),[s,c]=w(!1),[m,h]=d.useState({current:1,pageSize:7,total:0});d.useEffect(()=>{c(!0),I(a,m).then(o=>(h(l=>({...l,total:+(o.headers.get("x-total-count")||0)})),o.json())).then(o=>{t(o)}).finally(()=>{c(!1)})},[JSON.stringify(m),a]);const S=async o=>{const l=await b(g+`squeeze?link=${o}`,{method:"POST"});if(l.ok){const p=await l.json();e.length===m.pageSize?(t(i=>[p,...i.slice(0,-1)]),h(i=>({...i,total:(i.total??0)+1}))):t(i=>[p,...i])}else{const p=await l.json();console.error(p)}},j=o=>{h({...o})},y=o=>{n(o)};return r.jsxs(T,{className:"content",bordered:!1,children:[r.jsx(F,{style:{textAlign:"center"},children:"Таблица"}),r.jsx(k,{bordered:!1,rowKey:o=>o.id,columns:P,dataSource:e,loading:s,onChange:j,pagination:m,className:"table"}),r.jsx(C,{mode:"multiple",defaultValue:a,style:{width:"100% "},onChange:y,options:E,disabled:s||e.length<1,placeholder:"Выберите сортировку",allowClear:!0,showSearch:!1}),r.jsx(v,{hanldeSumbit:S})]})};export{wt as Content,wt as default};
